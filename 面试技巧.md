# 鼠鼠的面试注意事项

1. 不要卖破绽，反问不用问具体的业务，不然让面试官觉得你理解的很肤浅。

2. 自我介绍

简短版：

面试官你好，我叫邹子健，本科毕业于南京大学地理信息科学，选修了几乎全部计算机课程，并升入香港中文大学读计算机科学与技术硕士。成绩比较好，拿过很多 GPA 奖学金。

我曾经在上海一家量化私募做过C++实习，学了一些 IO 和计算优化的方法，并参与了公司的集群调度算法优化工作。

我主要做了两个项目，一个是 CMU 的数据库内核实现的开源项目，实现了**基于改良版 LRUK 调度算法的 buffer pool**、 **支持乐观锁的 B+ 树索引**、带有**简单优化规则的 SQL 引擎**和**基于两阶段锁的并发控制**四个模块。

第二个是基于 Raft 共识算法的 KV 存储系统，用 C++ 模仿论文和 go 的实现版本实现了 **raft 的选举**、**心跳**、**日志复制**、**快照**等功能。并且把复制状态机连接到一个**跳表**，实现了客户对 KV 存储系统的**一致性读写**。

以上是我的介绍。



可能被问到的。

### 零拷贝

#### mmap

mmap 跳过了 page cache

通常使用 mmap() 的三种情况： **提高I/O效率、匿名内存映射、共享内存进程通信** 。

```c++
// 返回一个 void* 指针。
// 输入开始地址，长度，权限，标志，文件描述符，偏移量。
// @para start 期望的地址 通常位 Null
// @para length
// @para prot 权限：PROT_READ PROT_WRITE
// @para flags MAP_SHARED
// 		MAP_SHARED： 调用进程对被映射数据所做的修改，对于共享该对象的所有进程可见。对共享区的写入，输出到原文件，变动是共享的。
// 		MAP_PRIVATE： 调用进程对被映射数据所做的修改，只对该进程可见。对共享区的写入，不会影响到原文件，变动是私有的。这个标志与MAP_SHARED标志是互斥的，只能使用其中一个。
void *mmap(void *start, size_t length, int prot, int flags,int fd, off_t offset)
// 
// 解除映射
int munmap( void * addr, size_t len);

// msync函数 将内存共享区的数据与磁盘上的文件内容立即同步。
// flags 异步写、同步写、使高速缓存数据失效
int msync( void *addr, size_t len, int flags);
```

mmap 流程

1. 进程启动映射过程，并在虚拟地址空间中为映射创建虚拟映射区域
2. 调用内核空间的系统调用函数mmap（不同于用户空间函数），实现文件物理地址和进程虚拟地址的一一映射关系
3. 进程发起对这片映射空间的访问，引发缺页异常，实现文件内容到物理内存（主存）的拷贝

mmap 优点：

* 少一次文件到内核缓冲区的拷贝。
* 提供了进程共享内存的方式。
* **基于缺页异常的懒加载**
* **减少 swap 操作** ： 保证一次全读进来
* 节约内存
*  mmap 的刷盘由系统全权控制

mmap 缺点：

* 不适合变长文件。
* 随机写不一定比缓冲区快。
* 受限于物理内存大小



#### sendfile

```c++
#include <sys/socket.h>
// 把 outfd 的东西发给 in_fd 
ssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count);
```

直接把内核缓冲区的数据拷贝到socket缓冲区古里。

传统：

两次 CPU copy 4 次上下文切换 2次DMA copy

#### 零拷贝方式

**用户态直接 I/O**、**减少数据拷贝次数**以及**写时复制**技术。



![img](https://pic1.zhimg.com/80/v2-18e66cbb4e06d1f13e4335898c7b8e8c_720w.webp)

#### splice

DMA 和 RDMA

